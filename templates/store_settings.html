{% extends "base.html" %}
{% block title %}–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Kaspi-–º–∞–≥–∞–∑–∏–Ω–∞{% endblock %}
{% block content %}
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f8f8f8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      padding: 40px 20px;
    }

    .form-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.08);
      max-width: 420px;
      width: 100%;
    }

    .faq-container {
      max-width: 500px;
      width: 100%;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      background: #e4002b;
      color: white;
      padding: 12px;
      border: none;
      width: 100%;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .success {
      text-align: center;
      color: green;
      font-weight: bold;
      margin-top: 20px;
    }

    .error {
      color: red;
      text-align: center;
    }

    .label {
      font-weight: bold;
      margin-top: 15px;
    }

    .faq-item {
      background: white;
      border-radius: 8px;
      margin-bottom: 10px;
      padding: 15px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      cursor: pointer;
    }
    .faq-item h4 {
      margin: 0;
      font-size: 1.1rem;
    }
    .faq-answer {
      display: none;
      margin-top: 10px;
      font-size: 0.95rem;
      color: #444;
    }

    .toggle-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 20px;
    }

    .toggle-wrapper input {
      transform: scale(1.3);
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 46px;
      height: 26px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      border-radius: 34px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      transition: .4s;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: .4s;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }
  </style>

<body>


  <main>
    <div class="form-container">
      {% if not store_name %}
        <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Kaspi</h2>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% for category, message in messages %}
            <p class="{{ category }}">{{ message }}</p>
          {% endfor %}
        {% endwith %}
        <form method="POST">
          <input type="email" name="kaspi_email" placeholder="Kaspi –ª–æ–≥–∏–Ω" required value="{{ session.get('kaspi_email', '') }}">
          <input type="password" name="kaspi_password" placeholder="–ü–∞—Ä–æ–ª—å" required>
          <button type="submit">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω</button>
        </form>
      {% else %}
        <h2>üõí –ú–∞–≥–∞–∑–∏–Ω: {{ store_name }}</h2>
        {% if api_token %}
          <p class="label">API —Ç–æ–∫–µ–Ω:</p>
          <input type="text" value="{{ api_token }}" disabled style="background:#f0f0f0;">
          <p class="label">–õ–æ–≥–∏–Ω:</p>
          <input type="text" value="{{ session.get('kaspi_email', '') }}" disabled style="background:#f0f0f0;">
          <p class="label">–ü–∞—Ä–æ–ª—å:</p>
          <input type="text" value="{{ session.get('kaspi_password', '') }}" disabled style="background:#f0f0f0;">
        {% endif %}
        <hr style="margin: 20px 0;">
<p class="label">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:</p>

{% if trial_until %}
  {% if current_time < trial_until %}
    <p style="color: green;">
      ‚úÖ –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω –¥–æ {{ trial_until }}.<br>
      –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–æ—Ç–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.
    </p>
  {% else %}
    <p style="color: orange;">
      ‚ö†Ô∏è –í–∞—à –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è {{ trial_until }}.<br>
      –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.
    </p>
  {% endif %}
{% elif paid_until is none %}
  <p style="color: orange;">
    ‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.<br>
    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.
  </p>

{% elif subscription_price == -1 %}
  <p style="color: red;">
    ‚õî –í–∞—à —Ç–∞—Ä–∏—Ñ "{{ plan_name }}" –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç {{ sku_count }} SKU.<br>
    –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞.
  </p>

{% elif subscription_active %}
  <p style="color: green;">
    ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ "{{ plan_name }}" –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ {{ paid_until }}.
  </p>

{% else %}
  <p style="color: orange;">
    ‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ "{{ plan_name }}" –∏—Å—Ç–µ–∫–ª–∞ {{ paid_until }}.<br>
    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –µ—ë, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É.
  </p>
{% endif %}


<div>
  <label class="switch">
    <input type="checkbox"
           id="repricerToggle"
           {% if repricer_running and subscription_active %}checked{% endif %}
           {% if not subscription_active %}disabled{% endif %}>
    <span class="slider round"></span>
  </label>
  <span id="toggleLabel">
    {% if not subscription_active %}
      üîí –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞
    {% elif repricer_running %}
      –û—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞
    {% else %}
      –í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞
    {% endif %}
  </span>
</div>

<script>
document.getElementById('repricerToggle').addEventListener('click', function (e) {
  if (this.disabled) {
    alert("üîí –†–µ–ø—Ä–∞–π—Å–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥.");
    e.preventDefault();
  }
});

document.getElementById('repricerToggle').addEventListener('change', function () {
  if (this.disabled) return;

  fetch("{{ url_for('toggle_repricer') }}", {
    method: "POST"
  })
  .then(() => {
    const label = document.getElementById('toggleLabel');
    label.textContent = this.checked ? "–û—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞" : "–í–∫–ª—é—á–∏—Ç—å –±–æ—Ç–∞";
  })
  .catch(err => alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–ø—Ä–∞–π—Å–µ—Ä–∞"));
});
</script>
      {% endif %}
    </div>

    <div class="faq-container">
      <h2>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h2>
      {% set faqs = [
        ('–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω Kaspi?', '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Kaspi –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ ‚Äú–ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω‚Äù.'),
        ('–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–µ–ø—Ä–∞–π—Å–µ—Ä?', '–û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç —Ü–µ–Ω—ã –≤–∞—à–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤, —á—Ç–æ–±—ã –±—ã—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–µ–µ –Ω–∞ Kaspi.'),
        ('–ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞?', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ ‚Äú–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏‚Äù.'),
        ('–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø–æ–¥–ø–∏—Å–∫–∞?', '–¶–µ–Ω—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ SKU: –æ—Ç 20 000‚Ç∏ –¥–æ 60 000‚Ç∏ –≤ –º–µ—Å—è—Ü.'),
        ('–ú–æ–≥—É –ª–∏ —è –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É?', '–ù–µ—Ç, –ø–æ–¥–ø–∏—Å–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –∑–∞ –ø–µ—Ä–∏–æ–¥ –∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω.'),
        ('–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ?', '–ü—Ä–æ—Å—Ç–æ –æ–ø–ª–∞—Ç–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ, –∏ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è.'),
        ('–ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è?', '–†–µ–ø—Ä–∞–π—Å–µ—Ä –∏ —Å–Ω—è—Ç–∏–µ —Å –ø—Ä–æ–¥–∞–∂–∏ —Å—Ç–∞–Ω—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏.'),
        ('–ù—É–∂–Ω–æ –ª–∏ —á—Ç–æ-—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å?', '–ù–µ—Ç, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ö–æ–¥–∞ –≤ –∞–∫–∫–∞—É–Ω—Ç.'),
        ('–ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SKU?', '–û–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏.'),
        ('–ö–∞–∫ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?', '–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ support@lkw.kz –∏–ª–∏ –≤ Telegram.')
      ] %}
      {% for question, answer in faqs %}
      <div class="faq-item" onclick="this.querySelector('.faq-answer').style.display = this.querySelector('.faq-answer').style.display === 'block' ? 'none' : 'block';">
        <h4>{{ question }}</h4>
        <div class="faq-answer">{{ answer }}</div>
      </div>
      {% endfor %}
    </div>
  </main>
{% endblock %}